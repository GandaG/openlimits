name: Rust

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

env:
  CARGO_TERM_COLOR: always

jobs:
  test:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Cache Cargo registry
      uses: actions/cache@v1
      with:
        path: ~/.cargo/registry
        key: ${{ runner.os }}-stable-cargo-registry-${{ hashFiles('**/Cargo.lock') }}
        restore-keys: |
          ${{ runner.os }}-stable-cargo-registry-
    - name: Cache Cargo index
      uses: actions/cache@v1
      with:
        path: ~/.cargo/git
        key: ${{ runner.os }}-stable-cargo-index-${{ hashFiles('**/Cargo.lock') }}
        restore-keys: |
          ${{ runner.os }}-stable-cargo-index-
    - name: Cache Cargo build
      uses: actions/cache@v1
      with:
        path: target/debug
        key: ${{ runner.os }}-stable-build-target-${{ hashFiles('**/Cargo.lock') }}
        restore-keys: |
          ${{ runner.os }}-stable-build-target-
    - name: Build
      run: cargo build --verbose
    - name: Run tests
      env:
        BINANCE_API_KEY: 0jfxupurrR9GS4las3IPSCceuRXLNVIfR00LkmX40s5VIapxo67bIds0os9W0Kc0
        BINANCE_API_SECRET: 7CknasnJSGggzqfOeqHN8Qy9afwiBYnh96Q8cW9SSAcyCd5JZyMouoBvKUdZpDE8
        COINBASE_API_KEY: 71178a875b2e58cf722768c97cc6cbd9
        COINBASE_API_SECRET: qWEkW67MjhHTmP0V5qOiycl8B1IWil3jumFmteYnkGH6Fycn1W5/iF9OwluACnIhby0fatCr++L+X9PJB8/jLw==
        COINBASE_PASSPHRASE: hzy38ul8f3j
        NASH_API_SECRET: eyJjaGlsZF9rZXlzIjp7Im0vNDQnLzAnLzAnLzAvMCI6eyJhZGRyZXNzIjoiMk45N0R3dFpoVFdOelVzS3g0TjlhWTVNOHdkbkd4VmlCa3giLCJjbGllbnRfc2VjcmV0X3NoYXJlIjoiMmJhMjAyMTU3YjA0MTRkY2U2OTI1Mzg0YjVlM2RkYTI0M2JkNjI2ZWI0YzRmODk3ZjIwZWM2ZTM4MzA3ZmQ3ZiIsInB1YmxpY19rZXkiOiIwMzJmMWU3MjgzOGY3Y2QwNDAwZWVmNjdiYzkzNTgyOTVmM2YzZGI3ODY5NzNjYTMzYTIyOWRmNjg5M2Y0MzQyMmYiLCJzZXJ2ZXJfc2VjcmV0X3NoYXJlX2VuY3J5cHRlZCI6IjVkMmVhMTUxYzM5MGNkMzVkZDQ1MjJlNmRlNmVjMmY3MDFmNzE3ZTQzYjdiZWJjZmZmNTAyMzA3YWZkNDBkNWM3NGNiNDFiNTdhYWUwYmM4MWE0NjA0YzAxNzQ0OGU1ODI5ZGM2ZDcwMGJhMjJiOWYxZTMyYzEyZTgxM2NlMWNlM2VlZWFmYmMzNzlmMzQyZDMwNGRlMTljY2EyNjJiYzA2ZDE0NzI4ZTNhZTQ1NjI2ODMwNzY5NTA5YTRiMmRlMTUwMDc0MzY0ODUyZTdhM2IxNGY4YWI3NWZjOTA4Yjc0NzVkYmE1MDljZjBlNjE5ZGYwMjI1NmY1Y2Q5MDkxYTNjM2RiZDdlZmI0MzkzYWJmZjdmZDY5NDI2YmY5ODlmZmEyODNjZmVhNTkxYjZlZjQxZmZiZmUxYzRlMWRlYjdjMTI0ZDdhMWQ5ODFlNTBhZDBhYjQ0MmIyM2M4Njk5NmE3ZmU4YTMyMTA0MWEwYzk2MGI5ODczYTc1OGFmZDcxY2FiOGRjNzFjNmMzZTQxNWYxYzNiYTE2NjFiOTcwYWJjYmI0ODIwZjk4MjI4ZDRkZWUzN2QyYjljZDcwYjg1OTBlMmEzYzE4ODYwYTcwYTcwYzVmZThhOGJjNjU5YmYwODg1YWEzY2Q3NjBhN2U0ZmExNzQ1OWRmZDg1MmZjZjdiMDA0ZGIwMGI4MjQ5NDA5ZjNmZWQzNDAxYTRiMjM3OThiMDRiYzVkYzkzOTI0NmVhYTI2NzUwMDk0NTQ5MTg3M2U2MjZhZTc1NmJhZThkMDAxOWMxZDc2NDE0YWZhM2VjNmQ1NWNiMTBhZmNhNDMxOTJiZGQzNjQwMDBhZGQwZDkwMmY0NWYwMDY5NWJmNzNlY2JmMmMwYmUwMTk5MWU2NDVmZTkxMTc1ZWUwNzBiOGZjNWJmYjVmMDllMDMxZWJkZjFhOGE5NDUwNzM2NjUxMzkxY2MxZDI0OTQzZWUwZWU1NTg1N2UzNThjZTZjM2M0MWZlMmIzZWVmMGQ0Zjg5NTU0MThjNTA4MmRjNDRmZjVhOWM2NmM0OTQ3NGE5MmFlZDA5ZjM2MTgwNzEyNmMxMGNjMzQxNDc4MDdkZTQ2ZjNlYmFiNjIwMTdlMGQ4NWU2NTZjNWJlYWUwMDlmNTEyOWVjYjM4N2I0ZDE4ZGNmOTIyM2ZkMzBlMTdkMjRkZjk4NTU0NWFkNWM2MWY5ODQwYzNlYjhiMWEyZGNkOWUyZmUwMDhkMGE5ZmViZTFjY2MxZTMwZWVlYTEyNjQ0MTBhYzU2MDdmYTZjNmE5NzM1NWFiNmE5NTZmZmQwYWEwZjdmMTdiNGZmZGM5MDNjY2FjNThkNmVlM2NmMjdmZGVlMiJ9LCJtLzQ0Jy82MCcvMCcvMC8wIjp7ImFkZHJlc3MiOiI0MjE5M2U3ZmZhMDNjZDE1ZWEyNTc1MWExMTY0Zjc1OGM3MWU1MmQxIiwiY2xpZW50X3NlY3JldF9zaGFyZSI6ImQ4NjU1NmMzN2JmOWY3ZGRjYzYxYTA5NTgzZTllZWU3Mjg5NzY4MDk1ZDE3Zjc1YjJjMTE1MjVkZDQ1NWU1Y2IiLCJwdWJsaWNfa2V5IjoiMDQ3MjQxY2FiYTEzNTMxODVhMDUyZWQ2ZjQ1NjVmMWI3NjQ1MTMzNWI3MzM1ZTQzOGY1YjdjYTU1ZTYwZTU1NmNmNGNiMDZiNjE4OWRhOGM3MGI2NDQ3ZmQwYzZhMGI4NDFjMzU2NmI0NGY5ODliNTJjYmIwZWFkNTM1YjFjYzk0NyIsInNlcnZlcl9zZWNyZXRfc2hhcmVfZW5jcnlwdGVkIjoiOGU3YzA5ODRiZGNiNTE2NWQ0ODNlNzI5OWEwNjhmMzYwODBlYmFiNjEyOTg5Y2FmZjAyYWRkNmZlOTY3ZTJiMWI2NzE5ZTBhOTY3M2M4ZTFhYzBiMzMxMjRkNzgyY2MzMTMzZTM2OTA0NDEwNThlN2E5N2EyYTZkOWJhOWI5Y2EwMWM5MmRjYTNlOTcyYTQwZGZhZDBjODk5ZmY1YTU5NDA3YjllZTdlODU0YTliMjQ0YmMwMjdhZDRlMmYwYjRiNTBjNjU3YmMxNTliNTQyYTAxZjEyNTJmNGNmYmQ5M2JiNzVlOTRmMjJkMDNhNDMyNzc1MmE2NjM4MmFlOTgwNjg0ODY0YWJlMmRiZjE1OWNlYzc3Y2ZhZGZjODUxMDc2ODAyOTUyYjllNmY2Y2ZhMTI5MTgxY2IxYTY3NmRhMWVhZDY5YmUyZmQzNWFlOTMwZjU4ZGUzOWE0ZGZiOTAyNmE1NjE5N2IyMzk5ZGI4OTRjZDJkM2ViNmY5MzVjMDFhY2FhMDMyYzVhZTAyYTIxMmNhYzZmNDA5ZGNjYmI0ZmQ4Mjg0MTM5YTQ1YTZkZTE1NjZkODc2ODZmOGQ2Yjg3ZTkwMGZlNmM4YWRmYmQ4MDUzMmYwYTM0N2IxNTgxNmExZjNkNGE0MmNiNDY3MzRmYTYwYWEyZjMzZDFjMDkwMzE1ZDE1MzE3Njk0OTlmZGE0Yjc3Njc1ZDlmYWI3ZmMzNWFhMGE1ZWZkMmY0NDk1YjgwMmRhMzdmZWU5OTc4ZDc3NTJjYzBhYzc1YWUxZWQ2YTk1MjNmYTMyMDViN2MyMjQ1OGM0NGJmM2RmZjNmNTViNWI2MzMwMzNiZjVkNDE3MGI2Yjc1M2QyNzMxNzJiMDU4NWQzMDA2ODA4MzVhZmZkNGM3OTU0MDU1ZmQxODRjZTljOGNlNTlkNjMzYmIzZWE1ZGYyMjk0NWFkNGI3NDkxOWY2NGIzZjQ5NGRmYzRmZjgzYjQ5ZmQ4OWYyMThkNWQ0N2E1MWJhZGM1ZmU2YjEyOWE4NWJkMWYxOTJlOTQzMzY0NmI3NDMzZDAxMDBjNmQ3YzM5MjIzNjY2MWZiY2ZmOTU2OGQ1NmRjYTZkZmUwYTQ1ZTJmMGViYTM1N2VmOWFiNmNlNzgxZmNmYWZmZTU1YTE0MWNjYjYyMzgyMTAzMjMxNDFiOGNlMDhkMDkzZDI5ZTVhZGM1YTg0ZWMwYTZmYTg5MTFmZGJkZWMzMWI4MDAxMTU0ZWM5MDZjMzQzNjhkY2EwNTgzYzMyYmIyYTFhMDFhY2FjOTYxNThmYjMyNGNkNTU0YzE2ZDRkMGEyNWQ2MjBmOGY4ZTQ1ZjkzYTE5MGU2ZTkzN2ZmOGJiZTkyIn0sIm0vNDQnLzg4OCcvMCcvMC8wIjp7ImFkZHJlc3MiOiJBR0Jld3hHdFNBQllmaVdNdDI1WmY4bWp1YUdQRnpjV2RpIiwiY2xpZW50X3NlY3JldF9zaGFyZSI6IjkxYWNiNjhkZTY2YzE3MjgzYTg0NjcxMjhhM2I5MDE5OTY2ZDUyNmJlYjlhOTc3NWU0M2Y5MTdhMDczMDFiMWIiLCJwdWJsaWNfa2V5IjoiMDJhM2JkNzQwMDI3NmUwOWRhYjNlZDAzNTkyZTZjNGI0N2IxMGEwMTlmZDBlZThmNWJkZWU5MWU0ZjJiYzFmMWJjIiwic2VydmVyX3NlY3JldF9zaGFyZV9lbmNyeXB0ZWQiOiIxNGVlZmUwMTNiMzI1OWU2NjYwMDk2MmUzZjdjMzAwYWIwZGQ5ODc2ZWQzZTlkMzgwMTE5MmEwODZlNGQ5ZWEyNDg1MDNjOWIyYjhiYTYyZDgyOWIzNGJiMTVlNjM5YThkZmE0MjIyZDA4NzYxZjYyOTkyMmQ2Zjk4Mzg1ZTRiMDgwODQ5YTk2YTVhYWY5NmIwNDRkM2RkNDkxNjZhN2EwYjFhMDM1YjNiNTcwYWI3Yzc4ZmEzNGExYzMxNTNjN2NhN2JkOWNmMmYxYjhiNDUyZDMwYTQ5NzFiMmI1NzdiYWEwMWEwODgxMjkzNDM5Yjc3ZjBmYzU5ODVhMmQyN2NmZjc2YzkxYmQwODBiNjgzMzVhMjJkNjM1MWU0OGNmMGM4ZWQxYzMyNDBhZWYxYzg4MTk0NWRhZGYyYTY3YTMyOWE5OWIwOWYxNmJhYzBlYzlmNDY0OTRlZjc0NWRkNjljMTk1NGZjOTAzNzYxODJkODFhNDk2NGY0N2I5OGIyZjNlYTNkZWJlYzczZDg5ZTRmNWE5NDE3NWY5MmYyNmFiOWNjOWM1MDhiZjJhOWQ0ZmY2MDlhNmU1MzAyOGFmNDFiNTQ0YzVmNTI5ZmFkNGM5NTEwZTNmYTMyYzBjOTdmZjUyMWY3YTI2M2JhMmNmZTRiNTg0ZDYzZGY4ZTk5YmU4N2JjZjAxYTc2NTM0NzdkNDVlYjA4ZDZjN2FlYzAyNzc4OGVhYjdjN2QyMTFmZDZlNDA4ZTYxNTIyMGIwYTI3NjI3NGVkZDM4MzFhNzc3Yzk1Njg4M2RkNTczNGVhMzk4YjcwYzM4NDBkZjAxMWNkMjdmNjAzYTMzOGNhOWM0ZDFkZGE0NDJiNzNlODhlMDNmMjFiNmU2M2Y3ODA0MmMxNzFhODY5OWVlOTI4YWVmMGM2MDk1ZDdhZDM4OTljZjJiZTk2M2U4ZmY2MzhiNjVhMDE4ZGI4MzkwY2I3NGRhZGFlZjZjZjgzMjhiOTZmYzRiNjlkNTAxNzQ2Mjc2YWZlZTM4MGFkYjk4ODJkMzNkOGNhYTg3MzA5Zjc5YzhjMDFiMmRjN2Q2ZTgyZWU4MzY5YWRjZGNiNjQ2N2YzZmM1NmM3NjJjZjYxNjY4NTlmNmRhN2ZmM2VhMzlkNjQ0NGM0YTMxNTNkYTQ2NGUwMGZiZDM4ZmJmYjNiNDYyNDMyYmNkOWFhYWMwZWZhZTlmNGQ4MGVmZjRiMmY1NzFhYTFiYTQxZDgxZjIxNTIzODg0NjRhNzdhOWQxMWI0NjNiMjRhMTY1NDlhNDQ0ZWRjNTNiYzkyMmYyZjA5OWYyNDhhMDIwNTQ4MTVkNzIwNWI5YmQ0NmZhNzIyMWM4NGVlOTI3OWEwIn19LCJwYWlsbGllcl9wayI6eyJuIjoiNTk4N2U2MjIyNjFjYWY5NmUyNTgyNmM3MGNmMzIzYjI2MTk0ZmY5Y2ZlNjllM2Y0MGYzMGQzMDY1NzE2NDJjYWVhOGEzMTQzZDExZmY5NGMxMzg4MzYwNDg2NzM1N2FlOGMwZTY2M2JmMDNkMDA5MzAxNmQ3ZjRkNzkwYWUyNGUyOTE3ODAzZDgxMmI2NDFhZjJkNmMwOTU3M2QxMTJlYjc2ODY0NjUyOTFjZDE0NmZkNjYyZjc3ZjU5NWVmODMyNzdiZTE2ODBkMDQwYjFmM2M0OTljODE5MTc1NzIwNmU1MTBhZTU0NzI0ZDY2N2ZjMDQxYTJjN2MyZmYzZDNiNjZjMzcyOWRjMjVlMDJjNDAxOWVkM2EwMTJmZDc1ZWMwZTAzOTQ4Y2Y3ODNhZDM5MDJjZTVlNWU3MjIyOWMzZGQzYTE0YjkzNGQ2MDI2OWFjYjdiYTBiZDQxNWQyZGUxMjhlZjE4NzIyNDAwYmFlYTJlODUwZTZkMWZkODc4N2EwMTMwZDUxNjIwNmQ3MThhNDlkN2EyMWQ0MjhiMGZhMzc3MzA3OWI2NDg2MTgxMTE5MWI1NTAwMWQ0YzJjMjlmNjMwMzE0YmUxOTFjZjNjYTNmMGY4ZTA5ZWUwOTU0M2ZmZGRhM2Y5N2NmMTY5ZDUyZTA2N2NmZDQwY2IzMDM5NDEifSwicGF5bG9hZF9wdWJsaWNfa2V5IjoiMDJhNGIzMjc2YzkyMGZiMTFjNzczODkxMjg0NTQ1NjIzMDM0ODc5ZjgyNTkwZjdiNTEyZDcyOTkyZTc2YTE3Mjg0IiwicGF5bG9hZF9zaWduaW5nX2tleSI6ImE1Nzk1NWQ0ZjJmZTdjMTNkYmQ0ZjQ2OWEzYTkzMmNlMzMzMzg4Y2NmMWM1Nzc4ZGM3YjgzMmU5MjE2Y2FlMDEiLCJ2ZXJzaW9uIjowfQ==
        NASH_API_KEY: 27b4b2e9-d188-4009-b951-3e7f6a974982

      run:  cargo test --release -- --test-threads=1

  clippy_check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - uses: actions-rs/toolchain@v1
        with:
            toolchain: stable
            components: clippy
            override: true
      - uses: actions-rs/clippy-check@v1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

  rustfmt_check:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - uses: actions-rs/toolchain@v1
        with:
            toolchain: stable
            components: rustfmt
            override: true
      - uses: mbrobbel/rustfmt-check@master
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
